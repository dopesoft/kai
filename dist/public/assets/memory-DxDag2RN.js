import{j as e}from"./radix-D6tAntsm.js";import{r as d,u as ke}from"./vendor-B5oVexe1.js";import{u as je,b as we,c as Ne}from"./query-4uz7M6Xs.js";import{A as Te,H as Se,S as Ee,T as z}from"./AuthSetupBanner-CPWk6td9.js";import{c as y,b as Me,a as Ce,S as Ie,T as Ae,d as De,e as J,B as x,f as q,L as _e}from"./index-TF11M3hR.js";import{B as Fe}from"./badge-BgMtBYxe.js";import{D as Q,a as K,b as V,c as G,d as W}from"./dialog-BRGN119b.js";import{q as Re,t as $e,u as Le,v as Oe,w as He}from"./icons-8ZevHjIu.js";import{f as Be}from"./utils-CElquc7p.js";import"./markdown-BBjlYdCw.js";import"./charts-BZMYq3Wc.js";import"./motion-C1uzXyO4.js";const X=d.forwardRef(({className:t,...l},i)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:i,className:y("w-full caption-bottom text-sm",t),...l})}));X.displayName="Table";const Y=d.forwardRef(({className:t,...l},i)=>e.jsx("thead",{ref:i,className:y("[&_tr]:border-b",t),...l}));Y.displayName="TableHeader";const Z=d.forwardRef(({className:t,...l},i)=>e.jsx("tbody",{ref:i,className:y("[&_tr:last-child]:border-0",t),...l}));Z.displayName="TableBody";const Pe=d.forwardRef(({className:t,...l},i)=>e.jsx("tfoot",{ref:i,className:y("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...l}));Pe.displayName="TableFooter";const T=d.forwardRef(({className:t,...l},i)=>e.jsx("tr",{ref:i,className:y("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...l}));T.displayName="TableRow";const f=d.forwardRef(({className:t,...l},i)=>e.jsx("th",{ref:i,className:y("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...l}));f.displayName="TableHead";const h=d.forwardRef(({className:t,...l},i)=>e.jsx("td",{ref:i,className:y("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...l}));h.displayName="TableCell";const Ue=d.forwardRef(({className:t,...l},i)=>e.jsx("caption",{ref:i,className:y("mt-4 text-sm text-muted-foreground",t),...l}));Ue.displayName="TableCaption";function ta(){const{user:t,profile:l,authEnabled:i}=Me(),{toast:c}=Ce(),[,A]=ke(),[D,ee]=d.useState(!1),[b,_]=d.useState("short-term"),[k,F]=d.useState(null),[ae,j]=d.useState([]),[te,w]=d.useState([]),[re,R]=d.useState(!1),[se,S]=d.useState(!1),[oe,E]=d.useState(!1),[u,M]=d.useState(""),[g,C]=d.useState(""),[I,$]=d.useState(null),[L,de]=d.useState(!1),[m,p]=d.useState(!1);je();const N=(()=>{const a=localStorage.getItem("anon_user_id");return(t==null?void 0:t.id)||a||null})(),{data:ie=[],refetch:ne}=we({queryKey:["threads",N],queryFn:async()=>{if(!N)return[];const a=await fetch(`/api/chat/threads?user_id=${N}`);if(!a.ok)throw new Error("Failed to fetch threads");return a.json()},enabled:!!N}),le=Ne({mutationFn:async a=>{const s=await fetch(`/api/chat/threads/${a}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete thread");return s.json()},onSuccess:()=>{ne()}}),O=()=>ee(a=>!a),ce=a=>{localStorage.setItem("activeThreadId",a),A("/")},me=()=>{localStorage.removeItem("activeThreadId"),A("/")},ge=async a=>{try{await le.mutateAsync(a),a===k&&(localStorage.removeItem("activeThreadId"),F(null)),c({title:"Success",description:"Conversation deleted"})}catch{c({title:"Error",description:"Failed to delete conversation",variant:"destructive"})}},he=async()=>{if(t!=null&&t.id){R(!0);try{const[a,s]=await Promise.all([fetch(`/api/memory/short-term?user_id=${t.id}`),fetch(`/api/memory/long-term?user_id=${t.id}`)]);if(!a.ok){const o=a.headers.get("content-type");throw o&&o.includes("text/html")?(console.error("Received HTML instead of JSON for short-term memories"),new Error("API returned HTML instead of JSON")):new Error(`Short-term memory API error: ${a.status}`)}if(!s.ok){const o=s.headers.get("content-type");throw o&&o.includes("text/html")?(console.error("Received HTML instead of JSON for long-term memories"),new Error("API returned HTML instead of JSON")):new Error(`Long-term memory API error: ${s.status}`)}const r=await a.json(),n=await s.json();j(r),w(n)}catch(a){console.error("Error fetching memories:",a),c({title:"Error",description:a instanceof Error?a.message:"Failed to load memories",variant:"destructive"})}finally{R(!1)}}};d.useEffect(()=>{const a=localStorage.getItem("activeThreadId");a&&F(a)},[]),d.useEffect(()=>{t!=null&&t.id&&i&&he()},[t==null?void 0:t.id,i]);const ye=()=>{M(""),S(!0),_(b)},H=()=>{S(!1),M("")},xe=async()=>{if(!(!(t!=null&&t.id)||!u.trim())){p(!0);try{const a=b==="short-term"?"/api/memory/short-term":"/api/memory/long-term",s={user_id:t.id,display_text:u.trim()};b==="short-term"&&k&&(s.thread_id=k);const r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.ok){const n=await r.json();b==="short-term"?j(o=>[n,...o]):w(o=>[n,...o]),c({title:"Success",description:"Memory added successfully"}),H()}else{const n=r.headers.get("content-type");if(n&&n.includes("application/json")){const o=await r.json();throw new Error(o.details||o.error||"Failed to add memory")}else throw new Error(`Server error: ${r.status} ${r.statusText}`)}}catch(a){console.error("Error adding memory:",a),c({title:"Error",description:a instanceof Error?a.message:"Failed to add memory",variant:"destructive"})}finally{p(!1)}}},fe=(a,s)=>{$(a),de(s);const r=a.display_text||"";C(r),E(!0)},B=()=>{E(!1),$(null),C("")},be=async()=>{if(!(!I||!(g!=null&&g.trim()))){p(!0);try{const a=L?`/api/memory/long-term/${I.id}`:`/api/memory/short-term/${I.id}`,s=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({display_text:g.trim()})});if(s.ok){const r=await s.json();L?w(n=>n.map(o=>o.id===r.id?r:o)):j(n=>n.map(o=>o.id===r.id?r:o)),c({title:"Success",description:"Memory updated successfully"}),B()}else throw new Error("Failed to update memory")}catch(a){console.error("Error updating memory:",a),c({title:"Error",description:"Failed to update memory",variant:"destructive"})}finally{p(!1)}}},ue=async(a,s)=>{if(window.confirm("Are you sure you want to delete this memory?")){p(!0);try{const r=s?`/api/memory/long-term/${a.id}`:`/api/memory/short-term/${a.id}`;if((await fetch(r,{method:"DELETE"})).ok)s?w(o=>o.filter(v=>v.id!==a.id)):j(o=>o.filter(v=>v.id!==a.id)),c({title:"Success",description:"Memory deleted successfully"});else throw new Error("Failed to delete memory")}catch(r){console.error("Error deleting memory:",r),c({title:"Error",description:"Failed to delete memory",variant:"destructive"})}finally{p(!1)}}},pe=a=>{var r;return((r=a.metadata)==null?void 0:r.auto_captured)===!0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{children:"AI"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{children:"User"})]})},ve=a=>{const s=new Date(a),r=new Date,n=Math.round((s.getTime()-r.getTime())/(1e3*60*60));return n<0?"Expired":n<24?`${n}h left`:`${Math.round(n/24)}d left`},P=(a,s)=>re?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(_e,{})}):e.jsx("div",{className:"h-full flex flex-col min-h-0 rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-black shadow-sm !m-0 !p-0",children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs(X,{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 !m-0 !p-0",children:[e.jsx(Y,{className:"sticky top-0 z-10",children:e.jsxs(T,{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800",children:[e.jsx(f,{className:"text-gray-900 dark:text-gray-100 font-medium",children:"Memory"}),e.jsx(f,{className:"text-gray-900 dark:text-gray-100 font-medium",children:"Tags"}),e.jsx(f,{className:"text-gray-900 dark:text-gray-100 font-medium",children:"Created By"}),e.jsx(f,{className:"text-gray-900 dark:text-gray-100 font-medium",children:"Date Created"}),!s&&e.jsx(f,{className:"text-gray-900 dark:text-gray-100 font-medium",children:"Expires"}),e.jsx(f,{className:"text-gray-900 dark:text-gray-100 font-medium",children:"Actions"})]})}),e.jsx(Z,{children:a&&a.length>0?a.map((r,n)=>{const o=s?[r.category]:r.tags||[],v=s?r.created_at:r.timestamp;return e.jsxs(T,{className:`transition-colors ${n%2===0?"bg-white dark:bg-black hover:bg-gray-50 dark:hover:bg-gray-900":"bg-gray-50 dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(h,{className:"max-w-xs whitespace-pre-wrap align-top text-gray-900 dark:text-gray-100",children:r.display_text||"No content"}),e.jsx(h,{className:"align-top",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:o&&o.length>0?o.map(U=>e.jsx(Fe,{variant:"secondary",className:"bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-800",children:U},U)):e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"No tags"})})}),e.jsx(h,{className:"align-top text-gray-900 dark:text-gray-100",children:pe(r)}),e.jsx(h,{className:"align-top text-gray-700 dark:text-gray-300",children:Be(new Date(v),"MMM dd, yyyy")}),!s&&e.jsx(h,{className:"align-top text-gray-700 dark:text-gray-300",children:ve(r.expires_at)}),e.jsx(h,{className:"align-top",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"icon",variant:"ghost",onClick:()=>fe(r,s),className:"hover:bg-gray-100 dark:hover:bg-gray-900 text-gray-500 dark:text-gray-400",children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx(x,{size:"icon",variant:"destructive",onClick:()=>ue(r,s),disabled:m,className:"bg-gray-100 dark:bg-gray-900 hover:bg-gray-200 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-300 dark:border-gray-700",children:e.jsx(Le,{className:"w-4 h-4"})})]})})]},r.id)}):e.jsx(T,{children:e.jsx(h,{colSpan:s?5:6,className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No memories found."})})})]})})});return e.jsxs("div",{className:"h-screen bg-white dark:bg-black text-gray-900 dark:text-gray-100 relative overflow-hidden flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:e.jsx(Ie,{})}),i===!1&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 p-4",children:e.jsx(Te,{})}),e.jsx(Se,{onToggleSidebar:O,isSidebarOpen:D}),e.jsxs("div",{className:"flex flex-1 min-h-0",children:[e.jsx(Ee,{isOpen:D,onClose:O,onThreadSelect:ce,onNewChat:me,activeThreadId:k,onThreadDelete:ge,threads:ie}),e.jsx("div",{className:"flex-1 flex justify-center items-start min-h-0",children:e.jsxs("div",{className:"max-w-[1100px] w-full bg-white dark:bg-black backdrop-blur-sm rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 p-8 h-[calc(80vh+16px)] flex flex-col min-h-0 mt-[105px]",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-900 dark:text-gray-100",children:"Memories"}),e.jsxs(Ae,{value:b,onValueChange:a=>_(a),className:"flex-1 flex flex-col min-h-0 !m-0 !p-0",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs(De,{className:"inline-flex h-10 items-center justify-start rounded-md bg-gray-100 dark:bg-gray-800 p-1 text-gray-600 dark:text-gray-400 w-fit",children:[e.jsx(J,{value:"short-term",className:"w-[120px] justify-center bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 data-[state=active]:bg-white dark:data-[state=active]:bg-black text-gray-700 dark:text-gray-300 data-[state=active]:text-gray-900 dark:data-[state=active]:text-gray-100 border-0 data-[state=active]:shadow-sm",children:"Short Term"}),e.jsx(J,{value:"long-term",className:"w-[120px] justify-center bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 data-[state=active]:bg-white dark:data-[state=active]:bg-black text-gray-700 dark:text-gray-300 data-[state=active]:text-gray-900 dark:data-[state=active]:text-gray-100 border-0 data-[state=active]:shadow-sm",children:"Long Term"})]}),e.jsxs(x,{variant:"outline",size:"sm",className:"flex items-center gap-2 bg-white dark:bg-black border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-900 text-gray-700 dark:text-gray-300",onClick:ye,disabled:!(t!=null&&t.id)||!i,children:[e.jsx(Re,{className:"w-4 h-4"}),"Add Memory"]})]}),e.jsxs("div",{className:"flex-1 !m-0 !p-0",children:[e.jsx(q,{value:"short-term",className:"h-full !m-0 !p-0 !mt-0 !pt-0 !bg-transparent data-[state=active]:block data-[state=inactive]:hidden",children:P(ae,!1)}),e.jsx(q,{value:"long-term",className:"h-full !m-0 !p-0 !mt-0 !pt-0 !bg-transparent data-[state=active]:block data-[state=inactive]:hidden",children:P(te,!0)})]})]})]})})]}),e.jsx(Q,{open:se,onOpenChange:S,children:e.jsxs(K,{className:"bg-white dark:bg-black border-gray-200 dark:border-gray-800",children:[e.jsx(V,{children:e.jsxs(G,{className:"text-gray-900 dark:text-gray-100",children:["Add ",b==="short-term"?"Short Term":"Long Term"," Memory"]})}),e.jsx("div",{className:"space-y-4",children:e.jsx(z,{value:u,onChange:a=>M(a.target.value),placeholder:"Enter your memory...",className:"min-h-[120px] bg-white dark:bg-black border-gray-300 dark:border-gray-700 text-gray-900 dark:text-gray-100",disabled:m})}),e.jsxs(W,{children:[e.jsx(x,{variant:"outline",onClick:H,disabled:m,className:"bg-white dark:bg-black border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Cancel"}),e.jsx(x,{onClick:xe,disabled:m||!(u!=null&&u.trim()),className:"bg-blue-600 hover:bg-blue-700 text-white",children:m?"Adding...":"Add Memory"})]})]})}),e.jsx(Q,{open:oe,onOpenChange:E,children:e.jsxs(K,{className:"bg-white dark:bg-black border-gray-200 dark:border-gray-800",children:[e.jsx(V,{children:e.jsx(G,{className:"text-gray-900 dark:text-gray-100",children:"Edit Memory"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(z,{value:g,onChange:a=>C(a.target.value),placeholder:"Edit your memory...",className:"min-h-[120px] bg-white dark:bg-black border-gray-300 dark:border-gray-700 text-gray-900 dark:text-gray-100",disabled:m})}),e.jsxs(W,{children:[e.jsx(x,{variant:"outline",onClick:B,disabled:m,className:"bg-white dark:bg-black border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Cancel"}),e.jsx(x,{onClick:be,disabled:m||!(g!=null&&g.trim()),className:"bg-blue-600 hover:bg-blue-700 text-white",children:m?"Saving...":"Save Changes"})]})]})})]})}export{ta as default};
